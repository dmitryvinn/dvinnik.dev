{"componentChunkName":"component---src-templates-article-index-js","path":"/articles/2022/manage-message-templates-whatsapp-business-api/","result":{"data":{"markdownRemark":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.416666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAMEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABxrhmhC//xAAYEAACAwAAAAAAAAAAAAAAAAAAESExQv/aAAgBAQABBQLTiz//xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8BxX//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQEABj8CIv/EABgQAQADAQAAAAAAAAAAAAAAAAEAESFB/9oACAEBAAE/IXIGU42N6En/2gAMAwEAAgADAAAAEP8Az//EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQMBAT8QHTku3//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAgEBPxBNyL//xAAaEAEBAAIDAAAAAAAAAAAAAAABEQAxIUFx/9oACAEBAAE/EDsJMcsMVy6nmBpA9Nz/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cover\"\n        title=\"cover\"\n        src=\"/static/7476a3a3aa2b48a1322bde0ba300495a/212bf/cover.jpg\"\n        srcset=\"/static/7476a3a3aa2b48a1322bde0ba300495a/7809d/cover.jpg 192w,\n/static/7476a3a3aa2b48a1322bde0ba300495a/4ecad/cover.jpg 384w,\n/static/7476a3a3aa2b48a1322bde0ba300495a/212bf/cover.jpg 768w,\n/static/7476a3a3aa2b48a1322bde0ba300495a/5ef17/cover.jpg 1152w,\n/static/7476a3a3aa2b48a1322bde0ba300495a/c8ae0/cover.jpg 1279w\"\n        sizes=\"(max-width: 768px) 100vw, 768px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><em>By Dmitry Vinnik</em></p>\n<p><em>Originally posted <a href=\"https://business.whatsapp.com/blog/manage-message-templates-whatsapp-business-api\">here</a>.</em></p>\n<p>WhatsApp message templates are a powerful way to send valuable information to customers. You can use them to deliver reminders, notifications, or customized updates.</p>\n<p>WhatsApp allows you to initiate direct conversations with users who have opted in to receiving messages. Additionally, you can reply to any message that a user has initiated. These users can then receive WhatsApp’s template-based messages.</p>\n<p>Using the WhatsApp Business Platform to generate these templates can streamline your communication with clients and greatly enhance user experience.</p>\n<p>Let’s consider an example. A hypothetical travel business — Terrific Travel Ltd. — offers services for reserving transportation, hospitality, and recreational activities. The global ubiquity of WhatsApp makes it an ideal platform for this business to communicate with its clients. While email confirmations are excellent for record-keeping, the ability to engage with customers in two-way conversations is of tremendous value for travelers on the go — and not one that traditional SMS can avail.</p>\n<p>Furthermore, WhatsApp message templates can enable Terrific Travel Ltd. to communicate with the optimal amount of personalized detail. In this case, a customized welcome message, timely notifications, and instantly accessible electronic tickets can go a long way to provide the customer peace of mind that their trip is managed — allowing them to relax and enjoy their vacation.</p>\n<p>To experience how easy it is to get the most out of the WhatsApp Business API and message templates, this hands-on tutorial will walk you through the processes of template management — including creation, deletion, and customization.</p>\n<p><strong>Managing Message Templates with the WhatsApp Business Platform</strong></p>\n<p><em>Prerequisites</em></p>\n<p>This tutorial assumes that you have a basic knowledge of Node.js and Express.js applications. Before moving forward, please complete the steps provided in the introductory section of the WhatsApp Business Platform documentation. If you’re a business solutions provider (BSP), follow Get Started for Business Solution Providers and ensure that your Meta app passes the review process.</p>\n<p>Before proceeding with the tutorial, ensure that you have a WhatsApp Business ID and a phone number ID.</p>\n<p>Additionally, BSPs require a system user token with the required permissions (whatsapp<em>business</em>management, whatsapp<em>business</em>messaging, and business_management).</p>\n<p>If you don’t have Node.js and Express.js applications, you can use this application boilerplate built specifically for the tutorial.</p>\n<p>Additionally, this tutorial will use several packages, including dotenv to store the token and requests to make HTTP requests with the API. We will also use Postman to test the API endpoints.</p>\n<p>For further exploration, the complete code is available here.</p>\n<p>Once you’ve set up the initial application and added the token with the proper permissions, you’re ready to start.</p>\n<p>Creating a New Message Template\nLet’s say Global Voyager wants to create several message templates for specific purposes. For example, they want to make one template for a customer greeting and another to send PDF copies of relevant documents.</p>\n<p>Before you begin coding, take a moment to understand how the template creation process works and which types of parameters it accepts. Additionally, it is crucial to note that Meta reviews templates daily and can reject them if they do not adhere to the guidelines as specified.</p>\n<p>The documentation states that you need to make a POST request to message_templates using your WhatsApp Business ID.</p>\n<p>The following parameters are accepted:</p>\n<pre><code>category of type ENUM\ncomponents of a type JSON array\nlanguage\nname\n</code></pre>\n<p>The components parameter defines the body of the message template. It accepts the following sub-parameters:</p>\n<pre><code>type — of the type ENUM of HEADER, BODY, FOOTER, and BUTTONS\nformat — of the type ENUM of TEXT, IMAGE, DOCUMENT, VIDEO, LOCATION\ntext — of the type string\nbuttons — of the type JSON array\n</code></pre>\n<p>Now, you have a text-based message template to greet customers and a media-based message template to send a PDF — and as per our example, these would be perfect for sending travel tickets or itinerary confirmations.</p>\n<p><strong>Creating a Text-based Message Template</strong></p>\n<p>First, you need to create a new router in routes/messageTemplates.js:</p>\n<p><code>router.post(\"/messageTemplate\", createMessageTemplate);</code></p>\n<p>Then, use the createMessageTemplate controller method, which we’ll make inside controllers/messageTemplate.js:</p>\n<pre><code>exports.createMessageTemplate = async (req, res) => {exports.createMessageTemplate = async (req, res) => {\n  const { name, language, category, components } = req.body;\n  if (!name || !language || !category || !components) {\n    return res.status(400).json({\n      error: \"Required Fields: name, language, category, and components\",\n    });\n  }\n  request.post(\n    {\n      url: `https://graph.facebook.com/v13.0/${process.env.META_BUSINESS_ID}/message_templates`,\n      headers: {\n        Authorization: `Bearer ${process.env.META_AUTH_TOKEN}`,\n        \"content-type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        name: name,\n        language: language,\n        category: category,\n        components: components,\n      }),\n    },\n    function (err, resp, body) {\n      if (err) {\n        console.log(\"Error!\");\n      } else {\n        res.json(JSON.parse(body));\n      }\n    }\n  );\n};\n</code></pre>\n<p>Below is a sample request object that you can pass to create the message template. {{1}} is used to pass variables. Note that {{X}} is used to define the message template variables not Postman variables.</p>\n<pre><code>{\n    \"name\": \"welcome_greetings\",\n    \"language\": \"en_US\",\n    \"category\": \"ALERT_UPDATE\",\n    \"components\": [\n        {\n            \"type\": \"HEADER\",\n            \"format\":\"TEXT\",\n            \"text\": \"Hi {{1}}! How are you?\"\n        },\n        {\n            \"type\": \"BODY\",\n            \"text\": \"Thank you for choosing Terrific Travel Ltd. as your vacation concierge! Please reach out to us if you have any questions or concerns.\"\n        },\n        {\n            \"type\": \"FOOTER\",\n            \"text\": \"Terrific Travel Ltd.\"\n        }\n    ]\n}\n</code></pre>\n<p>The successful API response returns the id value, representing the template ID.</p>\n<p><strong>Creating a Media-Based Message Template</strong></p>\n<p>After you finish the text-based template, you can create media-based templates just as easily. These are flexible and efficient means of sending documents that a customer can access immediately.</p>\n<p>The template below will feature a HEADER that will include the attached document, a BODY component, and a FOOTER component:</p>\n<pre><code>{\n    \"name\": \"sample_ticket_confirmation\",\n    \"language\": \"en_US\",\n    \"category\": \"TICKET_UPDATE\",\n    \"components\": [\n        {\n            \"type\": \"HEADER\",\n            \"format\": \"DOCUMENT\"\n        },\n        {\n            \"type\": \"BODY\",\n            \"text\": \"This is your flight confirmation for {{1}}-{{2}} on {{3}}.\"\n        },\n        {\n            \"type\": \"FOOTER\",\n            \"text\": \"This message is from an unverified business.\"\n        }\n    ]\n}\n</code></pre>\n<p>Note: Before you can use the message templates to communicate with customers, the templates must be approved and adhere to the Message Template Guidelines.</p>\n<p><strong>Retrieving a List of Existing Message Templates</strong></p>\n<p>Now that you have created the message templates, you can retrieve them. To do this, make a GET call to:</p>\n<p><code>https://graph.facebook.com/v13.0/whatsapp-business-account-ID/message_templates</code></p>\n<p>Note: The API version can change. Ensure that your URL is updated accordingly.</p>\n<p>Next, create a new route in <code>routes/messageTemplates.js</code>:</p>\n<p><code>router.get(\"/messageTemplates\", getMessageTemplates);</code></p>\n<p>The above getMessageTemplates is a controller method that you can create in controllers/messageTemplate.js. See below:</p>\n<pre><code>exports.getMessageTemplates = async (req, res) => {\n  request.get(\n    {\n      url: `https://graph.facebook.com/v13.0/${process.env.META_BUSINESS_ID}/message_templates`,\n      headers: {\n        Authorization: `Bearer ${process.env.META_AUTH_TOKEN}`,\n      },\n    },\n    function (err, resp, body) {\n      if (err) {\n        console.log(\"Error!\");\n      } else {\n        res.json(JSON.parse(body));\n      }\n    }\n  );\n};\n</code></pre>\n<p>A successful response includes the templates you created and WhatsApp’s sample template.</p>\n<p><strong>Deleting a Message Template</strong></p>\n<p>Similar to your GET route, you can also create a DELETE route in routes/messageTemplates.js:</p>\n<p><code>router.delete(\"/messageTemplate\", deleteMessageTemplate);</code></p>\n<p>Now, create the supporting controller method in controllers/messageTemplates.js:</p>\n<pre><code>exports.deleteMessageTemplate = async (req, res) => {\n  request.delete(\n    {\n      url: `https://graph.facebook.com/v13.0/${process.env.META_BUSINESS_ID}/message_templates`,\n      headers: {\n        Authorization: `Bearer ${process.env.META_AUTH_TOKEN}`,\n        \"content-type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        name: req.body.name,\n      }),\n    },\n    function (err, resp, body) {\n      if (err) {\n        console.log(\"Error!\");\n      } else {\n        res.json(JSON.parse(body));\n      }\n    }\n  );\n};\n</code></pre>\n<p>To delete a template, you must pass the template name as a JSON body.</p>\n<p>For example, the below screenshots show a successful Postman request and response for deleting a template named demo<em>template</em>user:</p>\n<p><strong>Sending a Message Using the Template</strong></p>\n<p>Now, let’s use a message template to send messages.</p>\n<p>First, make a router and its supporting controller. Inside routes/messageTemplates.js, add:</p>\n<p><code>router.post(\"/sendMessage/:id\", sendMessage);</code></p>\n<p>In the above code, the :id parameter is used to pass the phone number ID. Here’s how the controller looks in controllers/messageTemplate.js.</p>\n<pre><code>exports.sendMessage = async (req, res) => {\n  const { id, to, type,template } = req.body;\n  if (!id || !to || !type || !template) {\n    return res.status(400).json({\n      error: \"Required Fields: to, type, template and id\",\n    });\n  }\n  request.post(\n    {\n      url: `https://graph.facebook.com/v13.0/${req.params.id}/messages`,\n      headers: {\n        Authorization: `Bearer ${process.env.META_AUTH_TOKEN}`,\n        \"content-type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        messaging_product: process.env.MESSAGING_PRODUCT,\n        to: to,\n        type: type,\n        template: template,\n      }),\n    },\n    function (err, resp, body) {\n      if (err) {\n        console.log(\"Error!\");\n      } else {\n        res.json(JSON.parse(body));\n      }\n    }\n  );\n};\n</code></pre>\n<p>You can now create a request object in Postman. Remember that you will pass one parameter — {{1}} — in the Header.</p>\n<p>The Postman request body demonstrates the text-based template we created.</p>\n<p>Note this code snippet from the above screenshot:</p>\n<pre><code>        \"components\": [\n            {\n                \"type\": \"HEADER\",\n                \"parameters\": [\n                    {\n                        \"type\": \"text\",\n                        \"text\": \"Name\"\n                    }\n                ]\n            }\n        ]\n</code></pre>\n<p>This snippet is used to pass the value to the parameter {{1}}. A successful response includes the message ID, as seen below.</p>\n<p>Here’s what this message looks like to customers on WhatsApp:</p>\n<p>Next, you will use a JSON request object for another template in which you need to pass a document in the HEADER as well as variables {{1}}, {{2}}, and {{3}} in the BODY.</p>\n<p>First, look at the screenshot below:</p>\n<p>Note that the below snippet passes the parameters for the HEADER:</p>\n<pre><code>            \"parameters\": [\n                {\n                    \"type\": \"DOCUMENT\",\n                    \"document\": {\n                        \"id\":\"984786545564592\"\n                    }\n                }\n            ]\n        },\n        {\n</code></pre>\n<p>Then, the following code does the same for the BODY:\n\"parameters\": [\n{\n\"type\": \"text\",\n\"text\": \"Toronto\"\n},\n{\n\"type\": \"text\",\n\"text\": \"Dubai\"\n},\n{\n\"type\": \"text\",\n\"text\": \"2022-05-03\"\n}\n]\n}\n]\n}\n}\nThe attached media could be a link or the uploaded media ID.</p>\n<p>Finally, the image below shows how a successful output appears on WhatsApp.</p>\n<p>Conclusion\nWith this tutorial, you have just started to explore the capabilities of the WhatsApp Business API for creating simple but powerful message templates. The ease and flexibility of the WhatsApp Business API can help any business improve their communication systems to help turn a customer into long-term business clients. Time to take advantage of the opportunity.</p>","frontmatter":{"title":"Managing Message Templates with the WhatsApp Business Platform","description":"This hands-on tutorial will walk you through the processes of template management — including creation, deletion, and customization.","canonicalUrl":"https://business.whatsapp.com/blog/manage-message-templates-whatsapp-business-api","date":"Jun 07, 2022"}}},"pageContext":{"slug":"/articles/2022/manage-message-templates-whatsapp-business-api/","previous":{"fields":{"slug":"/articles/2022/meet-the-developers-mobile-edition-with-pritesh/"},"frontmatter":{"title":"Meet the Developers: Mobile Edition (Pritesh Nandgaonkar)"}},"next":{"fields":{"slug":"/articles/2022/meet-the-developers-mobile-edition-with-vadims/"},"frontmatter":{"title":"Meet the Developers: Mobile Edition (Vadims Savjolovs)"}}}},"staticQueryHashes":["2125292342","2915660680","3649515864","63159454"]}