{"componentChunkName":"component---src-templates-article-index-js","path":"/articles/2022/whatsapp-api-with-java/","result":{"data":{"markdownRemark":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.10416666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHakiwX/8QAGBAAAgMAAAAAAAAAAAAAAAAAEBEAITH/2gAIAQEAAQUCtsbEP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAQACAwAAAAAAAAAAAAAAAAEAEBEhUf/aAAgBAQABPyEAldTGuGBK/9oADAMBAAIAAwAAABCwz//EABcRAAMBAAAAAAAAAAAAAAAAAAEQEUH/2gAIAQMBAT8QNxf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEBAAICAwAAAAAAAAAAAAABEQAhEDFBUWH/2gAIAQEAAT8Qohb0vWNg8e8GlLjshq5u5X7x/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cover\"\n        title=\"cover\"\n        src=\"/static/e3de52cbde08bb6293f56e3b798fd490/212bf/cover.jpg\"\n        srcset=\"/static/e3de52cbde08bb6293f56e3b798fd490/7809d/cover.jpg 192w,\n/static/e3de52cbde08bb6293f56e3b798fd490/4ecad/cover.jpg 384w,\n/static/e3de52cbde08bb6293f56e3b798fd490/212bf/cover.jpg 768w,\n/static/e3de52cbde08bb6293f56e3b798fd490/a2510/cover.jpg 1000w\"\n        sizes=\"(max-width: 768px) 100vw, 768px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><em>By Dmitry Vinnik</em></p>\n<p><em>Originally posted <a href=\"https://developers.facebook.com/blog/post/2022/11/07/adding-whatsapp-to-your-java-projects/\">here</a>.</em></p>\n<p>WhatsApp Business Platform is a messaging solution that supports businesses at scale. It provides you with tools to help automate responses to customer messages or showcase a catalog of available products.</p>\n<p>With the <a href=\"https://developers.facebook.com/docs/whatsapp/cloud-api/\">Cloud API</a>, hosted by Meta, Meta's integration of the WhatsApp Business Platform, your apps can use WhatsApp to send and receive messages to create an engaging experience for your customers. The Cloud API also scales easily to meet temporary demand spikes as business volume expands.</p>\n<p>This article demonstrates how to build a Java app to send a simple text-based message and then dives into using message templates for more detailed messages. The full project code is available on <a href=\"https://l.facebook.com/l.php?u=https%3A%2F%2Fgithub.com%2Ffbsamples%2Fwhatsapp-api-examples%2Ftree%2Fmain%2Fsend-messages-ecommerce-app-java&#x26;h=AT2ZmvH94606BQyU9HwnFONESRvVf6mcvHUZ_zYmGq_-yMRsGijws4fMzkbUykVCJsZ7PRFXzgMvNgnOgzPAfsssFhQf3CaLyS5dussZsVgCTqRPDRJgDn0b0odvxE-4WiDspQpLBniV1S3N2W4MEwoEiRoAeKfUWge7ytY68bk\">GitHub</a>.</p>\n<p><strong>Getting Started</strong></p>\n<p>The first step in this tutorial is to create a brand-new Java project in Visual Studio Code (VS Code) and add functionality to send messages via the API.</p>\n<p>Make sure you do the following before you get started:</p>\n<ul>\n<li><a href=\"https://l.facebook.com/l.php?u=https%3A%2F%2Fcode.visualstudio.com%2F&#x26;h=AT1UgoudUX58eWdyqnPvG2aAxSFS-brGjNJrInARFCHOes7Kt1kfcEjO4-wIxQO6OsqLx_g2yIwjPO9nX8chw0KL1BDClgOyAp85ugDHjGahGj4qwiFLGTQclY15P18vHTrQWmsEMSF2THhzD8GxKCLFUDha2cL-ZM6JPbcNBGEAV9klRC5TPtIZ\">Install VS Code</a>.</li>\n<li>Install the <a href=\"https://l.facebook.com/l.php?u=https%3A%2F%2Fcode.visualstudio.com%2Fdocs%2Fjava%2Fjava-tutorial&#x26;h=AT34kl5_YLIOe2kFwlyEGvdWktwC4rUjrK7wHHsMpLTHC-IrMYw2EBt8KciEaBni4v6e13yIUwRVhR2wtrrPypKp34oUxFyUGzl5sw8lYB03lKoEfq-LT5eXm2V8a1Mc0Y3dfQ7b7x5lNClADq5K_k-JvXmMkh1jD6EwmxVKces\">Java Coding Pack</a> for VS Code.</li>\n<li>Ensure you have <a href=\"https://l.facebook.com/l.php?u=https%3A%2F%2Fwww.oracle.com%2Fjava%2Ftechnologies%2Fdownloads&#x26;h=AT0HwWiKagbkU6C32zkASHn36KvfkR1JK4OFQIU-KM7XEYA9MhlFMN78pViwSubumxD6UB7uCY7cA--Z60sbIbeuXbddKD1RcIMQQ0TaPwcliQCt_pnrL7Sml5Flbj1XvmBAZZws_hKrojjalnape1iunyPZTPchKK4NIzmUq4w\">Java version 11</a> or greater installed.</li>\n<li>Register as a developer at <a href=\"https://developers.facebook.com/\">Meta for Developers</a>.</li>\n<li><a href=\"https://www.facebook.com/business/help/280940009201586\">Enable two-factor authentication</a> on your account.</li>\n<li>Ensure your Meta account is linked to a <a href=\"https://www.facebook.com/business/learn/how-business-manager-works/guide\">Meta Business account</a>.</li>\n</ul>\n<p>Once complete, create an app on Meta for Developers. Start by visiting <a href=\"https://developers.facebook.com/\">Meta for Developers</a> and clicking My Apps. Then, click Create App and select Business as the app type.</p>\n<p>Provide the requested details, including the app name and contact email address, and select your business account from the dropdown. Once the app is created, scroll down and click Set up from the WhatsApp card, as shown below:</p>\n<p><img src=\"https://scontent.fyvr1-1.fna.fbcdn.net/v/t39.2365-6/313402656_668561641287664_1648746768096124062_n.png?_nc_cat=109&#x26;ccb=1-7&#x26;_nc_sid=ad8a9d&#x26;_nc_ohc=Yxy9sBIZi1QAX8Lzijs&#x26;_nc_oc=AQnHLvFV9sa7jH9IaG-8oY3mz8z6LQlBPRo963czGvOfFHTrlYV0UL1BqVjg8x3a8jAcO3c_AVjmOxQ3F2oxiTx1&#x26;_nc_ht=scontent.fyvr1-1.fna&#x26;oh=00_AfAZ8vDkkF6yhsGpXlfUam_fH03l0TQdXPrfVOyCK2L_fg&#x26;oe=637622B8\"></p>\n<p>This will take you to the Getting started page, which contains all of the information you need for your Java app to start sending WhatsApp messages. Additionally --- and most importantly --- this page provides a temporary access token and the pre-populated cURL command that's necessary for sending your first test message.</p>\n<p><img src=\"https://scontent.fyvr1-1.fna.fbcdn.net/v/t39.2365-6/313426201_825706398556138_7079902985241481480_n.png?_nc_cat=102&#x26;ccb=1-7&#x26;_nc_sid=ad8a9d&#x26;_nc_ohc=eH_TFFd91uUAX9M63Dt&#x26;_nc_ht=scontent.fyvr1-1.fna&#x26;oh=00_AfA9hnWtgLRkZut3NxjnIbUBYMqRqQkFwyu1wFrP6WnABA&#x26;oe=6376D264\"></p>\n<p>Now that your app is created in the Meta for Developers console, open VS Code and create your new Java application.</p>\n<p>In VSCode, create a new Java project by opening the command palette (Cmd+P/Ctrl+Shift+P) and typing \"Create Java Project.\"</p>\n<p><img src=\"https://scontent.fyvr1-1.fna.fbcdn.net/v/t39.2365-6/314351207_526830615959850_838277651216113463_n.png?_nc_cat=103&#x26;ccb=1-7&#x26;_nc_sid=ad8a9d&#x26;_nc_ohc=ay0A1Ia0eXMAX-Ywjwy&#x26;_nc_ht=scontent.fyvr1-1.fna&#x26;oh=00_AfD9JkGw9O_t8O-Fj_VY1HHftMKoyctrz6mzUyDtJqqvFA&#x26;oe=63779EE3\"></p>\n<p>You have the option to choose your favorite build tools or select none. You won't need any for this tutorial, so you don't need to select any tools.</p>\n<p>Then, follow the instructions to choose a location for the project and provide it with a name. This generates some boilerplate Java code with a main function that prints \"Hello World!\"</p>\n<p>Now that you're set up and have all the necessary information, you're ready to modify the boilerplate Java code and send your first message.</p>\n<p><strong>Sending an Example Message</strong></p>\n<p>On the Getting started page in the Meta for Developers console, there's an example cURL request that provides details about which URL you need to call, the headers you should provide, and an example payload to include as the body.</p>\n<p>You can translate this to Java code by using the built-in java.net packages that provide the functionality to create an HTTP client.</p>\n<p>Next, build and send a request, then you can parse the response.</p>\n<p>Let's break this down. Note that some parts of this code need to be replaced with your own details. These are marked with chevrons, like <YOUR PHONE NUMBER ID>. Make sure the number you're sending a message to <a href=\"https://developers.facebook.com/docs/whatsapp/cloud-api/reference/phone-numbers#formatting\">includes the country code and is formatted correctly</a>.</p>\n<p>First, you're creating an HTTP request using a builder. You're supplying the builder with the URI and the two header properties.</p>\n<p>Then, you're using the POST function, so the builder knows it's a POST request. This is also where you set the payload body. Here, you can copy and paste the body provided on the Getting started page --- just remember to escape the double quotation marks.</p>\n<p>Next, you're creating a new HTTP client to send your request. The <code>HttpResponse&#x3C;String></code> object captures the response and provides functions to access things like the response status code and body.</p>\n<p>You can run the Java app by right-clicking on the project in VS Code under the JAVA PROJECTS heading and clicking Run.</p>\n<p><img src=\"https://scontent.fyvr1-1.fna.fbcdn.net/v/t39.2365-6/313440497_1729836650720925_5621719295650719430_n.png?_nc_cat=106&#x26;ccb=1-7&#x26;_nc_sid=ad8a9d&#x26;_nc_ohc=2hXMY0C6j8sAX_tplHw&#x26;_nc_ht=scontent.fyvr1-1.fna&#x26;oh=00_AfD5fBT8ao-gDF5IC423SgApjMpuXncsR9_yqy0eqQxZYg&#x26;oe=637788A8\"></p>\n<p>If everything is configured correctly, a WhatsApp message similar to the one below should have been sent to the target phone number. Note that Meta's provided example template sets the message's content.</p>\n<p><img src=\"https://scontent.fyvr1-1.fna.fbcdn.net/v/t39.2365-6/313443023_662059892246561_8632701818956486089_n.png?_nc_cat=105&#x26;ccb=1-7&#x26;_nc_sid=ad8a9d&#x26;_nc_ohc=1huxWGRdhkoAX98DW4R&#x26;_nc_ht=scontent.fyvr1-1.fna&#x26;oh=00_AfDkodP0Nf1jUFG7plRYB11qXVo-fvxreCZ1B0xBXKYI5w&#x26;oe=63773A49\"></p>\n<p>Now that your example message works, you can send a simple text message without using a message template.</p>\n<p>For this to work, you need to reply to the initial message that was sent using this template. The contents of the reply don't matter. Once that's finished, you can modify your POST request to provide a simple text message payload.</p>\n<p>As you can see, the type property has now been changed to text. You also replace the template object with a text object specifying the desired message.</p>\n<p>Now, rerun the application. You'll see a second WhatsApp text message arrive:</p>\n<p><img src=\"https://scontent.fyvr1-1.fna.fbcdn.net/v/t39.2365-6/313435932_796428735047373_3228724126827474603_n.png?_nc_cat=101&#x26;ccb=1-7&#x26;_nc_sid=ad8a9d&#x26;_nc_ohc=Y5w63MHV-ZUAX9G9U1Y&#x26;_nc_ht=scontent.fyvr1-1.fna&#x26;oh=00_AfDktNDWP4m8EOSB9sI_TcqDpeRLHfLcy0IJ1n96m-pHbw&#x26;oe=6376BFDC\"></p>\n<p>You can now successfully send a simple text message using the API!</p>\n<p><strong>Creating Your Own Message Template and Sending a Message</strong></p>\n<p>Next, you'll create your own message template for sending more rich and personalized messages, containing an image and a call to action.</p>\n<p>From the Getting started page in the Meta for Developers console, step two features a link to create your own message template. Click this and then click Create Message Template. First, select Transactional as the message category, and then provide a name and a language.</p>\n<p><img src=\"https://scontent.fyvr1-1.fna.fbcdn.net/v/t39.2365-6/312983963_1171539260124843_5930136989088153905_n.png?_nc_cat=102&#x26;ccb=1-7&#x26;_nc_sid=ad8a9d&#x26;_nc_ohc=Kh6YAQnawFEAX9tZG-f&#x26;_nc_ht=scontent.fyvr1-1.fna&#x26;oh=00_AfDZIno_i-QiZQiO_hscdabvlmec5EkHvNqGGS8WhM-TFQ&#x26;oe=6375F384\"></p>\n<p>Start building the template by choosing an Image as the Header, filling in the Body, and <a href=\"https://developers.facebook.com/docs/whatsapp/cloud-api/reference/messages\">dynamically using parameters</a> to change the message's content.</p>\n<p><img src=\"https://scontent.fyvr1-1.fna.fbcdn.net/v/t39.2365-6/313432772_1173565063262767_4106066021207428412_n.png?_nc_cat=103&#x26;ccb=1-7&#x26;_nc_sid=ad8a9d&#x26;_nc_ohc=83K0104cJzIAX-Pze04&#x26;_nc_ht=scontent.fyvr1-1.fna&#x26;oh=00_AfCOqlNLzLxM9z0E8196ZcU0z_xup42DfRNgnXa2PgRB6w&#x26;oe=63767AEE\"></p>\n<p>Finally, add a Footer and a Call To Action. For this tutorial, use the Visit Website call to action, which allows you to provide a URL. This adds the call to action to the bottom of the message, as shown in the preview in the image above.</p>\n<p><img src=\"https://scontent.fyvr1-1.fna.fbcdn.net/v/t39.2365-6/313327974_642908974229161_5457606916653807620_n.png?_nc_cat=109&#x26;ccb=1-7&#x26;_nc_sid=ad8a9d&#x26;_nc_ohc=EF886uDKyZ4AX-FVr6C&#x26;_nc_ht=scontent.fyvr1-1.fna&#x26;oh=00_AfAx6dR12ZRObyUPfW1621QyLtb42HbUJt1ix3zYEuTNjA&#x26;oe=63775C46\"></p>\n<p>To ensure your template is accepted, make sure it follows the <a href=\"https://developers.facebook.com/docs/whatsapp/message-templates/guidelines/\">proposed guidelines</a> and that you've provided sample data. You can provide data using the Add Sample button at the top of the page.</p>\n<p>The approval process can take a bit of time, so while you're waiting, modify the code in preparation to use this new template.</p>\n<p>Again, you only need to make changes to the POST section of your HTTP request builder and modify the request body to use the new template --- similar to the very first example. The difference with your new template is that it uses two components: a header and a body.</p>\n<p>Within the components array, start by specifying your header component and declaring your image parameters. This enables you to provide an image URL for each message, which is useful if you have different images for different user segments.</p>\n<p>The body component contains the text that should replace the parameter placeholder ({{1}}) you added while building the template. Now that it's set up, check that the message template has been approved in the console. If so, run the code again. You'll see a new message should match the template, similar to what's shown below:</p>\n<p><img src=\"https://scontent.fyvr1-1.fna.fbcdn.net/v/t39.2365-6/313417398_702553954129677_8976788652428163948_n.png?_nc_cat=101&#x26;ccb=1-7&#x26;_nc_sid=ad8a9d&#x26;_nc_ohc=xa0UhYT7sGQAX-8R95Y&#x26;_nc_ht=scontent.fyvr1-1.fna&#x26;oh=00_AfDEWgcQPNf56SP3SmqBVJYqx5WOc5GD9QVgLFlAuIgr2Q&#x26;oe=63779E91\"></p>\n<p><strong>Best Practices</strong></p>\n<p>This post took you through the basics of getting started with the Cloud API to send simple text and template-based messages. When adding this to a production application, there are some best practices to follow.</p>\n<p>First, message templates must be used to start business-initiated conversations. You saw this when sending a simple text message, as before it could work, you had to send the example message template and respond to it. Then, this opened the conversation to further messages.</p>\n<p>Second, as your app will be calling an external service, it's important to make use of the asynchronous calls the HTTP client provides. Using<code>client.sendAsync</code> will prevent the main thread from being blocked, so the application can continue doing other things while waiting for the message to be sent.</p>\n<p>You should also consider how you're going to authenticate with the API. You can create a permanent access token or <a href=\"https://developers.facebook.com/docs/whatsapp/on-premises/reference/users/login\">request an access token</a> from the API. In either scenario, you should ensure that you <a href=\"https://developers.facebook.com/docs/facebook-login/access-tokens/security\">secure sensitive details</a> and refrain from hardcoding them in your application.</p>\n<p>Finally, it's important to add error handling to your application. Several factors could prevent a message from being sent, and your application should know how to deal with them. Meta provides a list of <a href=\"https://developers.facebook.com/docs/whatsapp/cloud-api/support/error-codes\">error codes</a> and their meanings so you can gracefully handle errors. You may want to code specifically for some common or predictable errors and provide default functionality for dealing with any others that occur. It's recommended to log these errors for later analysis.</p>\n<p><strong>Next Steps</strong></p>\n<p>This tutorial demonstrated how to build a Java application that can send messages via the Cloud API. You've sent simple text-based messages and more complex messages containing images and call-to-actions using bespoke message templates.</p>\n<p>The API is a simple-to-use REST API, making it effortless to integrate into a Java application utilizing Java 11's built-in HTTP libraries to build and send HTTP requests. With the addition of <a href=\"https://developers.facebook.com/docs/whatsapp/cloud-api/guides/set-up-webhooks\">webhooks</a>, you have the ability to build an application that can send automated messages in near real time, creating even more ways to interact with your users.</p>","frontmatter":{"title":"Adding WhatsApp to Your Java Projects","description":"This article describes how you can integrate the Cloud API, hosted by Meta, Meta’s integration of the WhatsApp Business Platform, into a Java application to enable sending and managing WhatsApp messages.","canonicalUrl":"https://developers.facebook.com/blog/post/2022/11/07/adding-whatsapp-to-your-java-projects/","date":"Nov 07, 2022"}}},"pageContext":{"slug":"/articles/2022/whatsapp-api-with-java/","previous":{"fields":{"slug":"/articles/2022/fixing-legacy-systems/"},"frontmatter":{"title":"Fixing broken windows: How to deal with legacy systems"}},"next":{"fields":{"slug":"/articles/2023/open-source-2022-year-in-review/"},"frontmatter":{"title":"Lightning Fast Testing for Salesforce with Applitools and TestZeus"}}}},"staticQueryHashes":["2125292342","2915660680","3649515864","63159454"]}